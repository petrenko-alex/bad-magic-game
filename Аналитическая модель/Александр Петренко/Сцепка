Сцепка формируется только на время передвижения, и после движения разрушается.

Сцепка храниться контейнером. 
Проверка возможности перемещения: проходим по контейнеру, и спрашиваем у всех ящиков,
могут ли они перемещаться, если могут, сохраняем этот признак для каждого ящика, если нет,
смотрим, что мешает,
если мешает ящик в сцепке, проверяем, может ли сдвинуться он(тут будет рекурсия скорее всего по всем ящикам в направлении)

Таким образом сцепка может сдвинуться только если все ее ящики могут сдвинуться.